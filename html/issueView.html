<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISSUES</title>

      

      <!--Bootstrap Icons-->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
   
      <!--Stylesheets-->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
      <link rel="stylesheet" href="/the-pillar-frontend/css/main.min.css">
      <link rel="stylesheet" href="/the-pillar-frontend/css/custom.css">
    
</head>
<body>

    <nav class="navbar navbar-expand-md bg-primary justify-content-center d-flex flex-column" id="nav-main-links">

        <!--first row-->
       <div class="row container-xxl">
  
        <!--col for The Pillar Logo-->
        <div class="col-6 col-md-3 d-flex justify-content-center align-items-center">
     
          <a class="navbar-brand nav-logo" href="/the-pillar-frontend/index.html">
          <img src="/the-pillar-frontend/images/The Pillar Logo - white.png" class="nav-logo-img" alt="The Pillar">
          </a>
        </div>
  
      <!-- Button trigger modal -->
      <div class="col-6 d-flex justify-content-end align-items-center"  id="profile-btn-div">
        <button type="button" class="btn p-0" data-bs-toggle="modal" data-bs-target="#exampleModal">
       <i class="bi bi-person-circle text-secondary fs-1" id="login-btn"> </i>
        </button>
      </div>
      </div>
     
      </nav>
  
        
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Welcome, Reader!</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
               
                <form action="" class=" border border-primary rounded p-5" id="log-in-form">
      
                  <div class="form-header text-center">
                    <img src="/the-pillar-frontend/images/The Pillar Logo.png" class="w-25" alt="">
                    <h2 class="fw-bold text-primary">LOG IN</h2>
                  </div>
            
                  <label for="Username" class="fw-bold">Username</label>
                  <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-person-fill text-primary"></i></span>
                    <input type="text" class="form-control" placeholder="Username" id="Username" aria-label="Username" aria-describedby="basic-addon1">
                  </div>
            
                  <label for="Password" class="fw-bold">Password</label>
                  <div class="input-group mb-3">
                    <span class="input-group-text"> <i class="bi bi-key-fill text-primary"></i></span>
                    <input type="password" class="form-control" placeholder="Password" id="Password" aria-label="Username" aria-describedby="basic-addon1">
                  </div>

                  <div class="alert alert-danger d-flex align-items-center mt-1 d-none" role="alert" id="login-div">
                    <i class="bi bi-exclamation-diamond-fill pe-2"></i>
                    <div id="login-error">
                      <!-- LOGIN ERROR MESSAGE GO HERE -->
                    </div>
                  </div>
            
                  <button class="btn btn-primary col-12 fw-bold" type="button" onclick="getInputs()" id="login-btn">LOG IN</button>
                  <h6 class="mt-2 mb-4 text-center"> <a href="/the-pillar-frontend/html/forgotPass.html" class="text-decoration-none">Forgot Password?</a> </h6>
            
                  <a class="btn btn-secondary col-12 fw-bold text-light" href="/the-pillar-frontend/html/sign-up.html">SIGN UP</a>
                  </form>
                  
              </div>
      
            </div>
          </div>
        </div>
        <!--end of Modal-->
      <!--End of first Nav-->
  
        <!--Start of second nav-->
        <nav class="navbar nav-pills nav-fill navbar-expand-sm d-flex justify-content-md-center bg-light bottom-shadow sticky-top"     
        id="nav-links">
        <button class="navbar-toggler w-100 d-flex justify-content-between ms-3 me-3 d-inline d-sm-none" type="button" data-bs-toggle="collapse"
            data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="fw-bold m-auto">Menu</span>
            <span class="navbar-toggler-icon"></span>
          </button>
    
    
       
        <div class="row container-lg">
         <div class="col collapse navbar-collapse" id="main-nav">
             <ul class="col navbar-nav fw-bold">
               <li class="nav-item">
                 <a class="nav-link nav-position" href="/the-pillar-frontend/index.html">HOME</a>
               </li>
               <li class="nav-item">
                 <a class="nav-link nav-position"  href="/the-pillar-frontend/html/article.html">ARTICLES</a>
               </li>
               <li class="nav-item">
                 <a class="nav-link nav-position active" aria-current="page" href="/the-pillar-frontend/html/issue.html">ISSUES</a>
               </li>
               <li class="nav-item dropdown d-none d-sm-inline">
                 <a class="nav-link nav-position" href="/the-pillar-frontend/html/aboutPage.html">ABOUT US <i class="bi bi-chevron-down ms-1"></i> </a>
                <ul class="dropdown-content bg-light">
                  <li>
                    <a href="/the-pillar-frontend/html/aboutPage.html#thePillarSection">The Pillar</a>
                  </li>
                  <li>
                    <a href="/the-pillar-frontend/html/aboutPage.html#CEGP">Membership and Alliance</a>
                  </li>
                  <li>
                    <a href="/the-pillar-frontend/html/aboutPage.html#editorialBoard">Editorial Board</a>
                  </li>
                </ul>
               </li>
    
    
               <li class="nav-item d-sm-none">
                <a class="nav-link nav-position" href="/the-pillar-frontend/html/aboutPage.html">ABOUT US <i class="bi bi-chevron-down ms-1 d-none d-md-inline"></i> </a>
                <ul class="list-content bg-light">
                  <li>
                    <a href="/the-pillar-frontend/html/aboutPage.html#thePillarSection">The Pillar</a>
                  </li>
                  <li>
                    <a href="/the-pillar-frontend/html/aboutPage.html#CEGP">Membership and Alliance</a>
                  </li>
                  <li>
                    <a href="/the-pillar-frontend/html/aboutPage.html#editorialBoard">Editorial Board</a>
                  </li>
                </ul>
               </li>
    
               </li>
               <li class="nav-item">
                 <a class="nav-link nav-position" href="/the-pillar-frontend/html/contactus.html">CONTACT US</a>
               </li> 
               </ul>
           </div>
        </div>
      </nav>
    </div>


    <div class="container-lg d-flex justify-content-center">
        <div class="issue-container">
                <div class="issue-title display-4" id="issue-file-title">THE PILLAR ISSUE </div>

                <div class="issue-group fw-bold fst-italic d-flex flex-column flex-md-row justify-content-around align-items-center">
                    <span id="volume-number"></span>
                    <span id="issue-category"></span>
                    <span id="issue-date-published"></span>               
                </div>                

                <p class="issue-description" id="issue-description">
                  <!-- ISSUE DESCRIPTION GO HERE -->
                </p>
        </div>
    </div>

   
      <div class="pdf-container container-fluid">
        
        <div id="expandingContainer" class="d-flex flex-column">

          
          <nav class=" pdf-viewer-bar d-flex justify-content-center align-items-start sticky-top" >
         

          <button  class="btn" id="expand-button"><i class="bi bi-arrows-angle-expand"></i></button>

          <button class="btn" onclick="zoomIn()" id="zoom-in"><i class="bi bi-plus-lg"></i></button>
          <button class="btn" onclick="zoomOut()" id="zoom-out"><i class="bi bi-dash-lg"></i></button>
          
          <div class="page-info text-center">
            Page <span id="page-num"></span> of <span id="page-count"></span>
          </div>
        </nav>

         <div class="row inner-pdf-viewer-container">
          <div class="row inner-most-pdf">        
            <canvas id="pdf-render"></canvas>
          </div>
         </div>



          <!-- prev and next button -->
        <button class="prev" id="prev-page">
          <i class="bi bi-caret-left-fill pn-icon"></i>
        </button>
        <button class="next" id="next-page">
          <i class="bi bi-caret-right-fill pn-icon"></i>
        </button>


        
        </div>

        

      </div>
      <div class="row d-flex flex-row justify-content-center m-2">

        <div class="row border border-1 border-primary rounded d-flex flex-row align-items-center liking-section">

          <div class="col-8 col-sm-6">
            <span class="h5 liking-text">Did you like this issue?</span>
          </div>
          <div class="col-4 col-sm-6 d-flex flex-row justify-content-end align-items-center">
            <i class="bi bi-hand-thumbs-up liking-btn" id="like-btn"></i> </i> <span id="nummberOfLikesIssues"></span>
            <i class="bi bi-hand-thumbs-down liking-btn" id="dislike-btn"></i>
          </div>


        </div>

        <div class="download-container" id="download-btn">
       </div>

      </div>
    
 




  

<!-- As a footer -->
<nav class="navbar bg-primary">

  <div class="container-xl d-flex flex-column-reverse flex-md-row justify-content-center align-items-center text-light p-1">
    <div class="col text-center">
      <small>Copyright Â© 2023 The Pillar. All rights reserved.</small>

    </div>
    <div class="col text-center">

      <small class="pe-1">Follow us on: </small> <a href="https://www.facebook.com/thepillaryueps"> <i class="bi bi-facebook text-light"></i> </a>
    </div>
   </div>

</nav>


<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="/the-pillar-frontend/js/get_account.js"></script>
<script src="/the-pillar-frontend/js/issue_likes.js"></script>
<script src="/the-pillar-frontend/js/login.js"></script>
<script>
  loadAccount();
  loadLikesAndDislikes();
</script>
<script>
  const button = document.querySelector('#expand-button');
  const container = document.querySelector('#expandingContainer');
  const pdfBar = document.querySelector('.pdf-viewer-bar');
  const arrowPrevButton = document.querySelector('#prev-page');
  const arrowNextButton = document.querySelector('#next-page');

  button.addEventListener('click', () => {
    container.classList.toggle('expanded');

    // If the container is expanded, change the icon to the contract icon
    if (container.classList.contains('expanded')) {
      button.innerHTML = '<i class="bi bi-arrows-angle-contract"></i>';
      pdfBar.style.position = "sticky";
      arrowPrevButton.style.position = "fixed";
      arrowNextButton.style.position = "fixed";
    }
    // Otherwise, change the icon to the expand icon
    else {
      button.innerHTML = '<i class="bi bi-arrows-angle-expand"></i>';
      pdfBar.style.position = "sticky";
      arrowPrevButton.style.position = "absolute";
      arrowNextButton.style.position = "absolute";
    }
  });
</script>

<script>
  async function PDF(){
      async function fetchIssue(issue_url){
        try{
          const response = await fetch(issue_url)
          
          if(!response.ok){
            throw new Error(`Failed to fetch issue : ${response.status}`);
          }
          return await response.json()
        }
        catch(error){
          console.log(error);
        }
      }
      
      async function getIssueFile(){
        let issue_id = localStorage.getItem('issueID');

        const issue_url = domain + `/publication/issues/?id=${issue_id}`
        // fetch the issue
        let issue_link = fetchIssue(issue_url)
        .then(data => {
          // url in s issue file
          displayDetails(data.results[0]);
          return data.results[0].issue_file.file;
        })
        .catch(error => (console.log(error)));
        return issue_link;
      }

      async function displayDetails(issue_data){
        document.getElementById('issue-file-title').textContent += issue_data.issue_number;
        document.getElementById('volume-number').textContent = `VOLUME ${issue_data.volume_number}`;
        let category = issue_data.category;

        // set up category display
        if(category === 'LF'){
            document.getElementById('issue-category').textContent = 'LITERARY FOLIO';
        }
        if(category === 'N'){
            document.getElementById('issue-category').textContent = 'NEWSLETTER';
        }
        if(category === 'SM'){
            document.getElementById('issue-category').textContent = 'SPORTS MAGAZINE';
        }
        if(category === 'T'){
            document.getElementById('issue-category').textContent = 'TABLOID';
        }
        

        // format date_published
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        let date_published = new Date(issue_data.date_published);
        date_published = `${monthNames[date_published.getMonth()]} ${date_published.getDate()}, ${date_published.getFullYear()}`.toUpperCase();

        document.getElementById('issue-date-published').textContent = date_published;

        // display description
        document.getElementById('issue-description').textContent = issue_data.description;
      }
      
      let issue_link = await getIssueFile()

      // setp download link or loggin prompt
      let access = localStorage.getItem('access');
      if(access){
        document.getElementById('download-btn').innerHTML += `<a class="download-link-btn" href="${issue_link}" download="The Pillar Issue">
                                                                <button type="button" class="btn download-btn btn-danger">
                                                                  <h4 class="fw-bold">
                                                                    <i class="bi bi-download"></i> DOWNLOAD ISSUE
                                                                  </h4>
                                                                </button>
                                                              </a>`;
      }
      
      // The workerSrc property shall be specified.
      pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';
      // issue_link
      const url = issue_link;
      
      let pdfDoc = null,
      pageNum = 1,
      pageIsRendering = false,
      pageNumIsPending = null;
      
      let scale = 5,
      canvas = document.querySelector('#pdf-render'),
      ctx = canvas.getContext('2d');
      
      let MIN_SCALE = 1;
      
      // Render the page
      const renderPage = num => {
        pageIsRendering = true;
        
      // Get page
      pdfDoc.getPage(num).then(page => {
        // Set scale
      const viewport = page.getViewport({ scale });
      canvas.height = viewport.height;
      canvas.width = viewport.width;
      
      const renderCtx = {
        canvasContext: ctx,
        viewport
      };
      
      page.render(renderCtx).promise.then(() => {
        pageIsRendering = false;

        if (pageNumIsPending !== null) {
          renderPage(pageNumIsPending);
          pageNumIsPending = null;
        }
      });
      
      // Output current page
      document.querySelector('#page-num').textContent = num;
    });
  };

  // Check for pages rendering
  const queueRenderPage = num => {
      if (pageIsRendering) {
        pageNumIsPending = num;
      } else {
        renderPage(num);
      }
    };
    
    // Show Prev Page
    const showPrevPage = () => {
      if (pageNum <= 1) {
        return;
      }
      pageNum--;
      queueRenderPage(pageNum);
    };
    
    // Show Next Page
    const showNextPage = () => {
      if (pageNum >= pdfDoc.numPages) {
        return;
      }
      pageNum++;
      queueRenderPage(pageNum);
    };
    
    // Get Document
    pdfjsLib
    .getDocument(url)
    .promise.then(pdfDoc_ => {
      pdfDoc = pdfDoc_;
      
      document.querySelector('#page-count').textContent = pdfDoc.numPages;
      
      renderPage(pageNum);
    })
      .catch(err => {
        // Display error
        const div = document.createElement('div');
        div.className = 'error';
        div.appendChild(document.createTextNode(err.message));
        document.querySelector('body').insertBefore(div, canvas);
        // Remove top bar
        document.querySelector('.top-bar').style.display = 'none';
      });
      
      
      
      // Button Events
      document.querySelector('#prev-page').addEventListener('click', showPrevPage);
      document.querySelector('#next-page').addEventListener('click', showNextPage);
}

let scale = 5;
const div = document.querySelector('.inner-most-pdf');

function zoomIn() {
  // Increment the scale factor by 0.5 to zoom in on the document

  div.style.height = div.offsetHeight + 50 + 'px';

  scale += 0.5;
}

function zoomOut() {
  
  div.style.height = div.offsetHeight - 50 + 'px';
  // Decrement the scale factor by 0.5 to zoom out on the document
  if (scale - 0.5 < MIN_SCALE) {
    return;
  }
  scale -= 0.5;
}
PDF()
</script>
</body>
</html>